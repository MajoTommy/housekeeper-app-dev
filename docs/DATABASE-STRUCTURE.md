# Database Structure Documentation

This document outlines the structure of the Firebase Firestore database used in the Housekeeping App.

## Overview

The database is organized around user accounts, with each user having their own collections for settings, clients, and bookings.
The primary user document (`/users/{userId}`) contains basic profile information (managed via `firestore-service.js#getUserProfile`, not detailed here).
Application settings, client details, and bookings are stored in subcollections under the user document.

## Data Models / Collections

### Settings (`/users/{userId}/settings/app`)

Stores application configuration for the user. This is the single source of truth for settings.
The data is stored in a single document named `app` within the `settings` subcollection.
*Note: A legacy `settings` field directly on the user document (`/users/{userId}`) is no longer used.*

```javascript
{
  // Represents the user's working schedule and preferences.
  // This object is normalized by firestore-service.js upon read/write.
  workingDays: {
    monday: {
      isWorking: true, // boolean: Is the user working this day?
      jobsPerDay: 2,   // number | null: Max jobs for this day
      startTime: "8:00 AM", // string | null: e.g., "HH:MM AM/PM"
      breakTime: 90, // number | null: Total break time in minutes
      breakDurations: [90], // array<number> | null: Duration of each break
      jobDurations: [180, 180] // array<number> | null: Duration of each job slot
      // endTime, cleaningDuration, maxHours might be present but often null/calculated
    },
    tuesday: { isWorking: true, /* ... other fields ... */ },
    wednesday: { isWorking: false, /* ... other fields ... */ },
    thursday: { isWorking: true, /* ... other fields ... */ },
    friday: { isWorking: true, /* ... other fields ... */ },
    saturday: { isWorking: false, /* ... other fields ... */ },
    sunday: { isWorking: false, /* ... other fields ... */ }
  },
  // Simplified structure for quick lookup, generated by firestore-service.js
  workingDaysCompat: {
    "0": false, // Sunday
    "1": true,  // Monday
    // ... etc for 2-6
  },
  autoSendReceipts: false, // boolean
  updatedAt: Timestamp // Firestore Server Timestamp
}
```

### Clients (`/users/{userId}/clients/{clientId}`)

Each client document contains information about a client.

```javascript
{
  firstName: "John",
  lastName: "Smith",
  street: "123 Main St",
  city: "Anytown",
  state: "CA",
  zip: "90210",
  phone: "555-123-4567",
  email: "john.smith@example.com",
  accessInfo: "Key under the mat",
  specialInstructions: "Please clean the windows thoroughly",
  frequency: "weekly",
  scheduleDay: "Monday",
  scheduleTime: "10:00 AM",
  propertyDetails: "3 bedroom, 2 bath house",
  price: "150",
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### Bookings (`/users/{userId}/bookings/{bookingId}`)

Each booking document represents a scheduled cleaning.

```javascript
{
  date: "2023-05-15",
  startTime: "9:00 AM",
  endTime: "12:00 PM",
  clientId: "abc123",
  clientFirstName: "John",
  clientLastName: "Smith",
  clientAddress: "123 Main St, Anytown, CA 90210",
  clientPhone: "555-123-4567",
  clientEmail: "john.smith@example.com",
  accessInfo: "Key under the mat",
  propertyDetails: "3 bedroom, 2 bath house",
  specialInstructions: "Please clean the windows thoroughly",
  frequency: "weekly",
  occurrenceNumber: 1,
  totalOccurrences: 8,
  status: "scheduled",
  price: "150",
  seriesId: "series-1234567890",
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

## Data Relationships

1. **Clients to Bookings**: Bookings reference clients using the `clientId` field. Essential client information is duplicated in the booking for quick access.

2. **Settings to Bookings**: The availability of time slots for bookings is determined by the user's settings stored in `/users/{userId}/settings/app`, specifically the `workingDays` object within that document.

3. **Series Bookings**: Recurring bookings are linked using the `seriesId` field, allowing operations on all bookings in a series.

## Best Practices

1. Always use the database as the source of truth. Do NOT hardcode data into the application. 